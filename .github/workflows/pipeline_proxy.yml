name: Pipeline Trigger Proxy

on:
  repository_dispatch:
    types: [trigger_pipeline]

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger LangGraph Orchestrator
        run: |
          curl -X POST \
            -H "Authorization: token ${{ secrets.BREVARD_BIDDER_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            "https://api.github.com/repos/breverdbidder/brevard-bidder-scraper/actions/workflows/langgraph_orchestrator.yml/dispatches" \
            -d '{
              "ref": "main",
              "inputs": ${{ toJson(github.event.client_payload) }}
            }'
          echo "âœ… Pipeline triggered"
      
      - name: Get Run ID
        id: get_run
        run: |
          sleep 3
          RUN_ID=$(curl -s \
            -H "Authorization: token ${{ secrets.BREVARD_BIDDER_TOKEN }}" \
            "https://api.github.com/repos/breverdbidder/brevard-bidder-scraper/actions/workflows/langgraph_orchestrator.yml/runs?per_page=1" | \
            jq '.workflow_runs[0].id')
          echo "run_id=$RUN_ID" >> $GITHUB_OUTPUT
          echo "Run ID: $RUN_ID"
